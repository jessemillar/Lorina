var Blueprint=function(){this.height=this.width=this.y=this.x=0;this.anchor={offset:{x:0,y:0}};this.bound={offset:{x:0,y:0},width:0,height:0};this.sprite={img:new Image};this.setPosition=function(a,b){this.x=a;this.y=b;return this};this.setSize=function(a,b){this.width=a;this.height=b;return this};this.setAnchor=function(a,b){this.anchor={offset:{x:a,y:b}};return this};this.setBound=function(a,b,c,d){this.bound={offset:{x:a,y:b},width:c,height:d};return this};this.setSprite=function(a){var b=this;
this.sprite.img.addEventListener("load",function(){b.sprite.width=this.width;b.sprite.height=this.height});this.sprite.img.src=a;return this};this.setAnimation=function(a,b){this.sprite.frame=0;this.sprite.count=a;this.sprite.timer=b;return this};this.setFriction=function(a){this.friction=a;this.momentum={x:0,y:0};return this}};var Camera=function(){l.camera={x:0,y:0,sandbox:{width:0,height:0}};this.reset=function(){l.camera.x=0;l.camera.y=0};this.follow=function(a,b,c){l.camera.sandbox.width=b;l.camera.sandbox.height=c;"shaking"!=this.state&&(l.camera.sandbox.width&&(a.anchor.x<l.camera.x+l.dom.width/2-l.camera.sandbox.width/2?l.camera.x=a.anchor.x-l.dom.width/2+l.camera.sandbox.width/2:a.anchor.x>l.camera.x+l.dom.width/2+l.camera.sandbox.width/2&&(l.camera.x=a.anchor.x-l.dom.width/2-l.camera.sandbox.width/2)),l.camera.sandbox.height&&
(a.anchor.y<l.camera.y+l.dom.height/2-l.camera.sandbox.height/2?l.camera.y=a.anchor.y-l.dom.height/2+l.camera.sandbox.height/2:a.anchor.y>l.camera.y+l.dom.height/2+l.camera.sandbox.height/2&&(l.camera.y=a.anchor.y-l.dom.height/2-l.camera.sandbox.height/2)),0>l.camera.x?l.camera.x=0:l.camera.x>l.canvas.width-l.dom.width&&(l.camera.x=l.canvas.width-l.dom.width),0>l.camera.y?l.camera.y=0:l.camera.y>l.canvas.height-l.dom.height&&(l.camera.y=l.canvas.height-l.dom.height))}};var Entity=function(){this.height=this.width=this.y=this.x=0;this.anchor={offset:{x:0,y:0}};this.bound={offset:{x:0,y:0},width:0,height:0};this.sprite={img:new Image};this.copy=function(a){this.x=parseInt(a.x);this.y=parseInt(a.y);this.width=parseInt(a.width);this.height=parseInt(a.height);this.anchor={offset:{x:parseInt(a.anchor.offset.x),y:parseInt(a.anchor.offset.y)}};this.bound={offset:{x:parseInt(a.bound.offset.x),y:parseInt(a.bound.offset.y)},width:parseInt(a.bound.width),height:parseInt(a.bound.height)};
this.sprite=a.sprite;this.update();return this};this["delete"]=function(){this.deleted=!0;return this};this.setPosition=function(a,b){this.x=a;this.y=b;return this};this.setSize=function(a,b){this.width=a;this.height=b;this.setBound(0,0,this.width,this.height);return this};this.setAnchor=function(a,b){this.anchor={offset:{x:a,y:b}};this.reposition();this.update();return this};this.reposition=function(){this.x-=this.anchor.offset.x;this.y-=this.anchor.offset.y};this.setBound=function(a,b,c,d){this.bound=
{offset:{x:a,y:b},width:c,height:d};this.update();return this};this.setSprite=function(a){var b=this;this.sprite.img.addEventListener("load",function(){b.sprite.width=this.width;b.sprite.height=this.height;l.preloader.current--;l.preloader.percent=Math.round(l.preloader.current/l.preloader.total);0==l.preloader.current&&(l.loaded=!0)});this.sprite.img.src=a;l.preloader.total++;l.preloader.current++;return this};this.setAnimation=function(a,b){this.sprite.frame=0;this.sprite.count=a;this.sprite.timer=
b;this.sprite.animation=this.animate(this);return this};this.animate=function(a){setInterval(function(){a.sprite.frame=a.sprite.frame<a.sprite.count-1?a.sprite.frame+1:0},a.sprite.timer)};this.pauseAnimation=function(){this.sprite.animation&&clearInterval(this.sprite.animation)};this.buffer=function(){this.deleted||l.buffer.push(this)};this.draw=function(){this.deleted||l.ctx.drawImage(this.sprite.img,Math.round(this.x),Math.round(this.y))};this.snapTo=function(a,b){this.x=a;this.y=b;this.reposition();
this.update();return this};this.moveUp=function(a){this.y-=a;this.update();return this};this.moveDown=function(a){this.y+=a;this.update();return this};this.moveLeft=function(a){this.x-=a;this.update();return this};this.moveRight=function(a){this.x+=a;this.update();return this};this.setFriction=function(a){this.friction=a;this.momentum={x:0,y:0};return this};this.freeze=function(){this.momentum.x=0;this.momentum.y=0};this.pushUp=function(a){this.momentum.y-=a;return this};this.pushDown=function(a){this.momentum.y+=
a;return this};this.pushLeft=function(a){this.momentum.x-=a;return this};this.pushRight=function(a){this.momentum.x+=a;return this};this.pullToward=function(a,b){var c=Math.abs(this.anchor.x-a.anchor.x),d=Math.abs(this.anchor.y-a.anchor.y),e=Math.sqrt(Math.abs(this.anchor.x-a.anchor.x)*Math.abs(this.anchor.x-a.anchor.x)+Math.abs(this.anchor.y-a.anchor.y)*Math.abs(this.anchor.y-a.anchor.y)),c=c/e*b,d=d/e*b;1<e&&(this.anchor.x<a.anchor.x&&this.anchor.y<a.anchor.y?(this.pushRight(c),this.pushDown(d)):
this.anchor.x>a.anchor.x&&this.anchor.y<a.anchor.y?(this.pushLeft(c),this.pushDown(d)):this.anchor.x<a.anchor.x&&this.anchor.y>a.anchor.y?(this.pushRight(c),this.pushUp(d)):this.anchor.x>a.anchor.x&&this.anchor.y>a.anchor.y&&(this.pushLeft(c),this.pushUp(d)));return this};this.bounce=function(a,b,c,d){a||b||c||d||(a=0,b=l.canvas.width,c=0,d=l.canvas.height);this.bound||this.setBound(0,0,this.width,this.height);this.x+this.bound.offset.x<=a?(this.x=a-this.bound.offset.x,this.momentum.x=-this.momentum.x):
this.x+this.bound.offset.x+this.bound.width>=b&&(this.x=b-this.bound.width-(this.width-this.bound.offset.x-this.bound.width),this.momentum.x=-this.momentum.x);this.y+this.bound.offset.y<=c?(this.y=c-this.bound.offset.y,this.momentum.y=-this.momentum.y):this.y+this.bound.offset.y+this.bound.height>=d&&(this.y=d-this.bound.height-(this.height-this.bound.offset.y-this.bound.height),this.momentum.y=-this.momentum.y);return this};this.physics=function(){0!==this.momentum.x&&(0>this.momentum.x?(this.moveLeft(Math.abs(this.momentum.x)),
this.momentum.x+=this.friction,0<this.momentum.x&&(this.momentum.x=0)):0<this.momentum.x&&(this.moveRight(Math.abs(this.momentum.x)),this.momentum.x-=this.friction,0>this.momentum.x&&(this.momentum.x=0)));0!==this.momentum.y&&(0>this.momentum.y?(this.moveUp(Math.abs(this.momentum.y)),this.momentum.y+=this.friction,0<this.momentum.y&&(this.momentum.y=0)):0<this.momentum.y&&(this.moveDown(Math.abs(this.momentum.y)),this.momentum.y-=this.friction,0>this.momentum.y&&(this.momentum.y=0)));this.update();
return this};this.update=function(){this.anchor.x=this.x+this.anchor.offset.x;this.anchor.y=this.y+this.anchor.offset.y;this.bound.x=this.x+this.bound.offset.x;this.bound.y=this.y+this.bound.offset.y}};var Group=function(){this.database=[];this.add=function(a){this.database.push(a)};this.remove=function(a){for(var b=this.database.length;b--;)if(this.database[b]==a){this.database.splice(b,1);break}};this.copy=function(a){for(var b=this.database.length;b--;)this.database[b].copy(a);return this};this["delete"]=function(){for(var a=this.database.length;a--;)this.database[a]["delete"]();return this};this.setPosition=function(a,b){for(var c=this.database.length;c--;)this.database[c].setPosition(a,b);
return this};this.setSize=function(a,b){for(var c=this.database.length;c--;)this.database[c].setSize(a,b);return this};this.setAnchor=function(a,b){for(var c=this.database.length;c--;)this.database[c].setAnchor(a,b);return this};this.setBound=function(a,b,c,d){for(var e=this.database.length;e--;)this.database[e].setbound(a,b,c,d);return this};this.setSprite=function(a){for(var b=this.database.length;b--;)this.database[b].setSprite(a);return this};this.setAnimation=function(a,b){for(var c=this.database.length;c--;)this.database[c].setAnimation(a,
b);return this};this.pauseAnimation=function(){for(var a=this.database.length;a--;)this.database[a].pauseAnimation();return this};this.buffer=function(){for(var a=this.database.length;a--;)this.database[a].buffer();return this};this.draw=function(){for(var a=this.database.length;a--;)this.database[a].draw();return this};this.snapTo=function(a,b){for(var c=this.database.length;c--;)this.database[c].snapTo(a,b);return this};this.moveUp=function(a){for(var b=this.database.length;b--;)this.database[b].moveUp(a);
return this};this.moveDown=function(a){for(var b=this.database.length;b--;)this.database[b].moveDown(a);return this};this.moveLeft=function(a){for(var b=this.database.length;b--;)this.database[b].moveLeft(a);return this};this.moveRight=function(a){for(var b=this.database.length;b--;)this.database[b].moveRight(a);return this};this.setFriction=function(a){for(var b=this.database.length;b--;)this.database[b].setFriction(a);return this};this.freeze=function(){for(var a=this.database.length;a--;)this.database[a].freeze();
return this};this.pushUp=function(a){for(var b=this.database.length;b--;)this.database[b].pushUp(a);return this};this.pushDown=function(a){for(var b=this.database.length;b--;)this.database[b].pushDown(a);return this};this.pushLeft=function(a){for(var b=this.database.length;b--;)this.database[b].pushLeft(a);return this};this.pushRight=function(a){for(var b=this.database.length;b--;)this.database[b].pushRight(a);return this};this.pullToward=function(a,b){for(var c=this.database.length;c--;)this.database[c].pullToward(a,
b);return this};this.bounce=function(a,b,c,d){for(var e=this.database.length;e--;)this.database[e].bounce(a,b,c,d);return this};this.physics=function(){for(var a=this.database.length;a--;)this.database[a].physics();return this}};var Keyboard=function(){var a=this;window.onkeydown=function(){a.pressed(event)};window.onkeyup=function(){a.cancel(event)};this.pressed=function(a){27==a.keyCode&&(this.escape=!0);32==a.keyCode&&(this.space=!0);13==a.keyCode&&(this.enter=!0);16==a.keyCode&&(this.shift=!0);65==a.keyCode&&(this.a=!0);83==a.keyCode&&(this.s=!0);38==a.keyCode&&(this.up=!0);40==a.keyCode&&(this.down=!0);37==a.keyCode&&(this.left=!0);39==a.keyCode&&(this.right=!0)};this.cancel=function(a){27==a.keyCode&&(this.escape=!1);
32==a.keyCode&&(this.space=!1);13==a.keyCode&&(this.enter=!1);16==a.keyCode&&(this.shift=!1);65==a.keyCode&&(this.a=!1);83==a.keyCode&&(this.s=!1);38==a.keyCode&&(this.up=!1);40==a.keyCode&&(this.down=!1);37==a.keyCode&&(this.left=!1);39==a.keyCode&&(this.right=!1)}};var l={},Lorina=function(){l.dom=document.getElementById("canvas");l.ctx=document.getElementById("canvas").getContext("2d");l.canvas={};l.buffer=[];l.camera={x:0,y:0};l.preloader={total:0,current:0,percent:0};l.loaded=!1;this.setSize=function(a,b){l.canvas.width=a;l.canvas.height=b;return this};this.setDomSize=function(a,b){l.dom.width=a;l.dom.height=b;return this};window.navigator.vendor?(this.setSize(256,224),this.setDomSize(l.canvas.width,l.canvas.height)):this.setSize(l.dom.width,l.dom.height);
this.makeFullscreen=function(){if(window.navigator.vendor){document.body.style.background=this.color;var a=this;window.onresize=function(){a.setFullscreen()};this.setFullscreen()}return this};this.setFullscreen=function(){l.dom.style.position="absolute";l.dom.style.left="0px";l.dom.style.top="0px";l.dom.width=window.innerWidth;l.dom.height=window.innerHeight;l.canvas.width=l.dom.width;l.canvas.height=l.dom.height;return this};this.start=function(a){this.setRoom(a);return this};this.stop=function(){clearInterval(this.loop);
return this};this.setRoom=function(a){this.loop&&clearInterval(this.loop);this.loop=setInterval(a,1E3/60);return this};this.setColor=function(a){this.color=a;return this};this.blank=function(a){l.ctx.fillStyle=a?a:this.color;l.ctx.fillRect(0,0,l.dom.width,l.dom.height);l.buffer.length=0;return this};this.draw=function(){l.buffer.sort(function(a,c){return a.anchor.y-c.anchor.y});for(var a=l.buffer.length;a--;)l.ctx.drawImage(l.buffer[a].sprite.img,Math.round(l.buffer[a].x-l.camera.x),Math.round(l.buffer[a].y-
l.camera.y));return this};this.checkCollision=function(a,b){return a.deleted||b.deleted?!1:a.bound.x<b.bound.x+b.bound.width&&a.bound.x+a.bound.width>b.bound.x&&a.bound.y<b.bound.y+b.bound.height&&a.bound.y+a.bound.height>b.bound.y?!0:!1}};var Measure=function(){this.random=function(a,b){return Math.random()*(b-a)+a}};var Mouse=function(){var a=this;document.onmouseout=function(){a["null"]()};document.onmousemove=function(){a.moved(event)};l.dom.onmousedown=function(){a.clicked(event)};l.dom.onmouseup=function(){a.cancel()};this.clicked={x:null,y:null};this.moved=function(a){a&&(this.x=a.clientX+l.camera.x,this.y=a.clientY+l.camera.y)};this["null"]=function(){a.x=null;a.y=null};this.clicked=function(a){a&&(this.clicked.x=a.x-l.dom.offsetLeft,this.clicked.y=a.y-l.dom.offsetTop)};this.cancel=function(a){this.clicked.x=
null;this.clicked.y=null}};var Tilt=function(){this.z=this.y=this.x=0;document.addEventListener("deviceorientation",function(a){this.x=a.beta;this.y=a.alpha;this.z=a.gamma},!0)};var Touch=function(){this.database=[];var a=this;document.touchstart=function(b){a.touches(b)};document.touchmove=function(b){a.touches(b)};document.touchend=function(b){a.touches(b)};document.touchcancel=function(b){a.touches(b)};this.touches=function(a){a?this.database=a.touches:this.database.length=0};this.checkTouched=function(a){if(0<this.database.length)for(var c=this.database.length;c--;){if(this.database[c].pageX<a.bound.x+a.bound.width&&this.database[c].pageX>a.bound.x&&this.database[c].pageY<
a.bound.y+a.bound.height&&this.database[c].pageY>a.bound.y)return!0;if(c==this.database.length-1)return!1}}};var Typewriter=function(){this.setFont=function(a){this.font=a;return this};this.setSize=function(a){this.size=a;return this};this.setAlignment=function(a){this.alignment=a;return this};this.setColor=function(a){this.color=a;return this};this.setTextMode=function(a){this.textMode=a;return this};this.setPosition=function(a,b){this.x=a;this.y=b;return this};this.writeText=function(a){l.ctx.font=this.font&&this.size?this.size+"px "+this.font:this.font?"10px "+this.font:this.size?this.size+"px sans-serif":
"10px sans-serif";l.ctx.fillStyle=this.color?this.color:"#000000";l.ctx.textAlign=this.alignment?this.alignment:"left";this.y=this.size?this.y+this.size:this.y+10;"hud"==this.textMode?l.ctx.fillText(a,this.x,this.y):l.ctx.fillText(a,this.x-l.camera.x,this.y-l.camera.y);return this}};